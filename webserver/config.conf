# ============================================================================
# WEBSERVER CONFIGURATION FILE
# ============================================================================

# ----------------------------------------------------------------------------
# SERVER 1: "webservers"
# Primary focus: Error pages, POST handling, and local redirection.
# ----------------------------------------------------------------------------
server {
    listen 8080                    # Port the server listens on
    server_name webservers         # Identified by 'Host: webservers' header
    
    # Custom error mappings: your code uses these to look up files when a request fails
    error_page 404 /404.html
    error_page 500 /500.html
    error_page 502 /502.html
    error_page 503 /503.html
    error_page 504 /504.html
    
    client_max_body_size 10M       # Rejects any POST larger than 10MB (HTTP 413)

    # Standard root location
    location / {
        allow_methods GET          # Only allow reading; POST/DELETE will return 405/403
        root /var/srv_webservers/www/
        autoindex off              # If no index.html found, return 404/403 (no list)
        index index.html           # Default file to serve for "webservers:8080/"
    }

    # Endpoint specifically for file uploads
    location /upload {
        allow_methods POST         # Restricted to POST only
        root /var/srv_webservers/uploads
        autoindex off
    }

    # Endpoint for form data submission
    location /submit {
        allow_methods POST
        root /var/srv_webservers/submit
        autoindex off
    }

    # Example of an internal 301 redirection
    location /redir {
        allow_methods GET POST
        return 301 /error/redirection.html; # Forces browser to fetch this new path
        root /var/www
        autoindex on               # If redirection fails, shows directory files
        index ex2.html
    }
}

# ----------------------------------------------------------------------------
# SERVER 2: "cookie"
# Primary focus: Multiple ports and Session/Cookie testing.
# ----------------------------------------------------------------------------
server {
    listen 8080 5963               # This server listens on two different ports
    server_name cookie             # Identified by 'Host: cookie'

    location / {
        allow_methods GET
        root /var/srv_cookie/www
        autoindex off
        index index.html           # Your code checks for "cookie" name to inject session IDs
    }
}

# ----------------------------------------------------------------------------
# SERVER 3: "pol"
# Primary focus: External Redirection.
# ----------------------------------------------------------------------------
server {
    listen 8080 5000               # Listens on port 8080 and 5000
    server_name pol

    location / {
        allow_methods GET
        # Sends user to a completely different domain (External URL)
        return 301 https://www.maybank2u.com.my/home/m2u/common/login.do
        root /var/srv_pol
        autoindex off
        index index.html
    }
}

# ----------------------------------------------------------------------------
# SERVER 4: "cgi"
# Primary focus: Backend script execution (Python/PHP).
# ----------------------------------------------------------------------------
server {
    listen 8080
    server_name cgi
    error_page 404 /404.html
    error_page 500 /500.html
    error_page 502 /502.html
    error_page 503 /503.html
    error_page 504 /504.html
    client_max_body_size 10M

    location / {
        allow_methods GET
        root /var/srv_cgi/www
        autoindex off
        index index.html
    }

    # Special block for executable scripts
    location /cgi-bin {
        allow_methods GET POST
        root /var/srv_cgi/cgi-bin
        autoindex on               # Lists available scripts in browser
        # cgi_pass <ext> <executor>: Tells server which binary to use for which file
        cgi_pass py /usr/bin/python3
        cgi_pass php /usr/bin/php
    }

    location /submit {
        allow_methods POST
        root /var/srv_cgi/submit
        autoindex off
    }
}

# ----------------------------------------------------------------------------
# SERVER 5: "drive"
# Primary focus: File management and Directory Listing.
# ----------------------------------------------------------------------------
server {
    listen 8080
    server_name drive
    client_max_body_size 10M

    location / {
        allow_methods GET
        root /var/srv_drive/www
        autoindex off
        index index.html
    }

    # A "Cloud Drive" style folder
    location /upload {
        allow_methods GET POST      # Allows viewing and uploading
        root /var/srv_drive/uploads
        autoindex on                # Shows all uploaded files as a list
    }

    location /submit {
        allow_methods POST
        root /var/srv_drive/submit
        autoindex off
    }
}